# Django
References [Quick Django Refresher Crash Course](https://build.vsupalov.com/quick-django-refresher-crash-course/) by Vladislav
&amp; Official Django Tutorials.

## Setup

### Virtual Environment
Using a Virtual Environment is recommended to separate the Python packages used for development
and the ones used by your system:
```sh
# create the virtual env
python -v venv venv
# activate the virtual env (needs to be done once per shell)
source venv/bin/activate
```

### Install Django
Install Django with `pip`:
```sh
pip install django
```

### Creating Django Projects &amp; Apps
A typical web with Django consists of:
- One Django Project representing that has Django Apps installed.
- Multiple Django Apps that a reusable components of a website: (ie poll app)

### Create Django Project
Create a Django Project with `NAME` in the current directory aka `.`:
```sh
django-admin startproject NAME .
```

#### Create &amp; Register Django Apps
1. Create a Django App with `NAME`:
```sh
python manage.py startapp NAME
```

2. Register the new Django App to be used with the Django Project in `settings.py`:
```python
INSTALLED_APPS = [
    "app.AppConfig"
]
```

## Django Development
Django follows the Model-View-Controller (MVC) pattern of structuring code:
- [Django Models](#django-models) are Models that store data and contain shared application logic.
- [Django Views](#django-views) are Controllers that contain page/request specific application logic.
- [Django Templates](#django-templates) are Views that render data server side to be sent to the user.

> Aim for Fat Models and Slim Views: Try to put more application logic in Models
> rather than Views as this would allow the logic to be better shared.

### Django Models
Django Models:
- Define the schema of how data is stored.
- What shared operations / application logic can be performed on said data

Using Django Models:
1. Define models in `models.py`:
```python
from django.db import models

class Question(models.Model):
    # data fields in the question model: maps columns on the DB table
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')

class Choice(models.Model):
    # data fields in the choice model: maps columns on the DB table
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)

   # foreign key specifying which question this choice belongs to 
    question = models.ForeignKey(Question, 
                                 # cascade: when the question referenced is delete this also.
                                 on_delete=models.CASCADE) 
```
2. Generate Database (DB) Migrations for the new / updated Django Model:
```sh
python manage.py makemigration
```
> Use `python manage.py sqlmigrate` to see the SQL generated by 
> `python manage.py makemigration`.

3. Run migrations to Migrate DB:
```sh
python manage.py migrate
```

> Django Models have significant array of methods for querying, moditifcation:
> ie `BlogPost.objects.filter(author=me).order_by("created_date")`  
> Use them instead of resorting to SQL too early.

### Django Views
Django Views contain request / page specific application logic:
- Django Views directly handle requests from users.
- Does some computing / Processing
- Renders the the Web Page / Response returned to the user.

Using Django (Class-based) Views:

```python
from django.shortcuts import render
from django.views import View

class BlogView(View):
    def get(self, request):
        # Parse Request and Do some computing
        posts = # ....
        # Prepare response
        # name of Django Template to render and return to user
        template_name = 'base.html'
        # dictionary of data available when rendering the Django Template
        context = {"posts": posts}
        return render(request, template_name, context)
```

### Django Templates
Django Templates server side rendered Templates that form the Web pages sent to user:
- By default: `.html` files under `templates` folder in Django Apps used as Django Templates
- Uses the data provided in the `context` dictionary provided by the Django View to render
- Can use static files (ie CSS / JS / Images) in `static/` folder located in each Django App

Using Django Templates to template:
```html
<header>
    <h1>Blog</h1>
</header>

{% for post in posts %}
    <article>
        <!--- Use a static image: "static/post_icon.png" -->
        <img src="{% static 'post_icon.png' %}" alt="Post Icon">
        <time>published: {{ post.published_date }}</time>
        <h2><a href="">{{ post.title }}</a></h2>
        <p>{{ post.text|linebreaksbr }}</p>
    </article>
{% endfor %}
````

> See the official [Django Templates](https://docs.djangoproject.com/en/3.2/topics/templates/)
> docs to see what can be done with Django Templates


## Further Reading
- [Django Girls tutorial](https://tutorial.djangogirls.org/en/)
- [Official Django Tutorial](https://docs.djangoproject.com/en/2.2/intro/tutorial01/)
